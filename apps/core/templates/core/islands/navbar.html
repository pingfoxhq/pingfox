{% load static %}

<nav x-data="{ open: false }" class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="{% url 'home' %}" hx-boost="false">
      <span class="icon">
        <img src="{% static 'img/logo.png' %}" alt="PingFox Logo" loading="lazy">
      </span>
      <span>
        <h4 class="title is-4 has-text-bold">
          PingFox
        </h4>
      </span>
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" @click="open = !open"
      :class="{ 'is-active': open }">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbarBasicExample" class="navbar-menu" :class="{ 'is-active': open }">
    <div class="navbar-start">
      <a class="navbar-item">Home</a>
      <a class="navbar-item">Documentation</a>

      <div x-data="{ dropdownOpen: false }" class="navbar-item has-dropdown" :class="{ 'is-active': dropdownOpen }">
        <a class="navbar-link" @click.prevent="dropdownOpen = !dropdownOpen">
          More
        </a>

        <div class="navbar-dropdown">
          <a class="navbar-item">About</a>
          <a class="navbar-item is-selected">Jobs</a>
          <a class="navbar-item">Contact</a>
          <hr class="navbar-divider">
          <a class="navbar-item">Report an issue</a>
        </div>
      </div>
    </div>

    <div class="navbar-end">
      {% if request.user.is_authenticated and user_teams %}
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link is-flex is-align-items-center">
          <figure class="image is-24x24 mr-2">
            <img class="is-rounded" src="{{ current_team.logo.url }}" alt="{{ current_team.name }}">
          </figure>
          <span>{{ current_team.name }}</span>
        </a>

        <div class="navbar-dropdown is-right">
          {% for team in user_teams %}
          <div class="navbar-item">

            <form method="post" action="{% url 'teams:switch' %}" class="navbar-item p-0">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.path }}">
              <button type="submit" name="team_id" value="{{ team.id }}" class="">
                <span class="icon">
                  <figure class="image is-20x20 mr-2">
                    <img class="is-rounded" src="{{ team.logo.url }}" alt="{{ team.name }}">
                  </figure>
                </span>
                <span class="underline-none">{{ team.name }}</span>
              </button>
            </form>


          </div>
          {% empty %}
          <div class="navbar-item">
            <span class="has-text-grey">No teams available</span>
          </div>
          {% endfor %}

          <hr class="navbar-divider">

          <a href="{% url 'teams:create' %}" class="navbar-item has-text-link is-flex is-align-items-center">
            <strong class="mr-2">+</strong> <span>Create New Team</span>
          </a>
        </div>
      </div>
      {% endif %}


      <div class="navbar-item">
        <div class="buttons">
          {% if request.user.is_authenticated %}
          <a class="button is-ghost" href="{% url 'accounts:index' %}">
            <article class="image is-36x36">
              <img src="{{ user.userprofile.avatar.url }}"
                alt="{% firstof request.user.get_full_name request.user.get_username %}'s Avatar"
                class="{{ user.profile.status }} is-rounded" width="100" height="100">
            </article>
          </a>
          <a class="button is-light" hx-boost="false" href="{% url 'accounts:logout' %}">
            Log out
          </a>
          {% else %}
          <a class="button is-primary" href="{% url 'accounts:register' %}">
            <strong>Sign up</strong>
          </a>
          <a class="button is-light" href="{% url 'accounts:login' %}">
            Log in
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</nav>