{% load static %}

<nav class="text-white shadow-md border-b border-gray-800">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">

      <!-- Logo -->
      <div class="flex items-center space-x-6">

        {% if request.user.is_authenticated %}
        <a href="{% url 'home' %}" class="flex items-center space-x-2" hx-boost="true">
          {% else %}
          <a href="{% url 'home' %}" class="flex items-center space-x-2" hx-boost="false">
            {% endif %}
            <img src="{% static 'img/logo.png' %}" alt="PingFox" class="h-7 w-auto" />
            <span class="text-lg font-semibold tracking-tight text-fox-text">PingFox</span>
          </a>

          {% if request.user.is_authenticated and request.user.team_members.exists %}
          <div class="dropdown">

            <div tabindex="0" role="button" class="btn btn-ghost">
              <span class="hidden md:inline"><img src="{{ current_team.logo.url }}" alt="" class="w-6 h-6 rounded-full inline-block mr-2">{{ current_team }}</span>
              {% for team in request.user.team_members.all %}
              {% if team.team.id == request.user.current_team_id %}
              <img src="{{ team.team.logo.url }}" class="w-6 h-6 rounded-full inline-block mr-2" />
              {{ team.team.name }}
              {% endif %}
              {% endfor %}
              â–¼
            </div>
            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-56">
              {% for team in request.user.team_members.all %}
              <li>
                <form method="post" action="{% url 'teams:switch' %}">
                  {% csrf_token %}
                  <button type="submit" name="team_id" value="{{ team.team.id }}"
                    class="flex items-center space-x-2 text-sm">
                    <img src="{{ team.team.logo.url }}" class="w-5 h-5 rounded-full" />
                    <span>{{ team.team.name }}</span>
                  </button>
                </form>
              </li>
              {% endfor %}
              <li><a href="{% url 'teams:create' %}" class="text-accent">+ Create New Team</a></li>
            </ul>
          </div>


          <script>
            function handleTeamSwitch(select) {
              const value = select.value;
              if (value === "new") {
                window.location.href = "{% url 'teams:create' %}";
              } else {
                document.getElementById('team-switcher-form').submit();
              }
            }
          </script>
          {% endif %}


      </div>


      <!-- Auth Buttons -->
      <div class="flex items-center space-x-4 text-sm">
        {% if request.user.is_authenticated %}
        <!-- show profile picture -->
        <a href="{% url 'accounts:edit_user_view' %}" class="flex items-center space-x-2">
          <img src="{{ request.user.userprofile.avatar.url }}" alt="{{ request.user.username }}'s avatar"
            class="h-8 w-8 object-cover rounded">
          <span class="hidden md:inline text-gray-300 hover:text-white">Hi, {{ request.user.username }}</span>
        </a>
        <a href="{% url 'accounts:logout' %}" class="btn btn-error" hx-boost="false">Logout</a>
        {% else %}
        <a href="{% url 'accounts:login' %}" class="btn btn-secondary">Login</a>
        <a href="{% url 'accounts:register' %}" class="btn btn-accent">Sign Up</a>
        {% endif %}
      </div>

    </div>
  </div>
</nav>