{% extends "base.html" %}
{% load static %}
{% block title %}Schema Editor - {{ form.name }}{% endblock %}

{% block content %}
<div class="is-flex is-justify-content-space-between is-align-items-center mb-4">
    <h1 class="title is-3 has-text-white">{{ form.name }}</h1>
    <a href="{% url 'forms:list' %}" class="button is-small">
        &larr; Back to Forms List
    </a>
</div>

<p class="is-size-7 has-text-grey-light mb-5">{{ form.description }}</p>

{% include 'core/islands/tab.html' with active_tab="forms" %}

<div class="is-flex is-justify-content-space-between is-align-items-center mb-5">
    <h2 class="title is-4 has-text-white">🧬 Schema Editor</h2>
    <div class="buttons">
        <a href="{% url 'forms:builder' form.slug %}" class="button is-small is-outlined">🔙 Switch to UI Builder</a>
        <button class="button is-primary is-small" hx-post="{% url 'forms:save_htmx' form.slug %}" hx-trigger="click"
            hx-include="#schema-editor" hx-target="#save-status" hx-swap="innerHTML">
            💾 Save Schema
        </button>
    </div>
</div>

<div class="columns is-variable is-6" hx-post="{% url 'forms:convert' %}" hx-include="#schema-editor" hx-trigger="load"
    hx-target="#form-preview" hx-swap="innerHTML">

    <!-- Left Column: JSON Editor -->
    <div class="column is-half">
        <form id="schema-editor" method="post">
            {% csrf_token %}
            <div class="field">
                <label class="label is-small has-text-grey-light">✏️ Form Schema (JSON)</label>
                <div class="control">
                    <textarea name="schema" rows="24"
                        class="textarea has-background-black has-text-white is-family-code is-small"
                        placeholder="Enter your form schema here..." hx-post="{% url 'forms:convert' %}"
                        hx-include="#schema-editor" hx-target="#form-preview" hx-swap="innerHTML"
                        hx-trigger="keyup changed delay:500ms">{{ schema|default:"{}" }}</textarea>
                </div>
            </div>
        </form>

        <div id="save-status" class="has-text-success is-size-7 mt-2"></div>

    </div>
</div>

<!-- Right Column: Live Preview -->
<div class="column is-half">
    <div class="is-flex is-justify-content-space-between is-align-items-center mb-2">
        <h2 class="is-size-7 has-text-grey-light has-text-weight-semibold is-uppercase">Live Preview</h2>
        <button class="button is-small is-outlined is-light" hx-post="{% url 'forms:convert' %}"
            hx-include="#schema-editor" hx-target="#form-preview" hx-swap="innerHTML">
            🔁 Refresh Preview
        </button>
    </div>

    <div id="form-preview" class="box">
        <p class="is-size-7 has-text-grey-light is-italic">Submit or refresh to see preview.</p>
    </div>
</div>
</div>
{% endblock %}